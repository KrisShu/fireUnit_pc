webpackJsonp([25],{"Vg4/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("mvHQ"),o=n.n(s),a=n("BO1k"),r=n.n(a),l=n("Nn1j"),i=n("HR9O"),c={components:{baseTable:l.a,baseDialog:i.a},data:function(){return{buttonarr:[{type:"primary",text:"全部"},{type:"success",text:"正常",num:0},{type:"warning",text:"故障",num:0},{type:"info",text:"离线",num:0}],screensign:"全部",loading:!1,tabelThead:[{name:"设备编号",prop:"detectorSn",with:"200px"},{name:"品牌",prop:"brand"},{name:"具体位置",prop:"location"},{name:"当前电量",prop:"powerNum"},{name:"状态",prop:"state"},{name:"操作"}],TotalCount:0,tableData:[],page:{fireunitId:localStorage.getItem("fireUnitID"),SkipCount:0,MaxResultCount:10,state:""},SmokesenseFrom:{fireUnitId:localStorage.getItem("fireUnitID"),enableFaultSMS:!0,enableAlarmSMS:!0},rules:{detectorSn:[{required:!0,message:"请填写设备型号",trigger:"blur"}],location:[{required:!0,message:"请填写设备安装位置",trigger:"blur"}]},clearFlag:!1}},mounted:function(){this.GetIndependentDetectorList()},methods:{GetIndependentDetectorStatesNum:function(){var e=this;this.$axios.get(this.$api.GetIndependentDetectorStatesNum,{params:{fireunitId:localStorage.getItem("fireUnitID")}}).then(function(t){e.buttonarr[1].num=t.data.result.normalNum,e.buttonarr[2].num=t.data.result.faultNum,e.buttonarr[3].num=t.data.result.offlineNum})},screen:function(e){this.page.state="全部"==e?"":e,this.screensign=e,this.page.SkipCount=0,this.GetIndependentDetectorList()},GetIndependentDetectorList:function(){var e=this;this.loading=!0,this.$axios.get(this.$api.GetIndependentDetectorList,{params:this.page}).then(function(t){var n=!0,s=!1,o=void 0;try{for(var a,l=r()(t.data.result.items);!(n=(a=l.next()).done);n=!0){var i=a.value;1==i.state?(console.log("ssssssssssss"),i.state="正常"):2==i.state&&(i.state="故障")}}catch(e){s=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(s)throw o}}e.loading=!1;var c=t.data.result;e.tableData=c.items,e.TotalCount=c.totalCount,0==t.data.result.items.length&&t.data.result.totalCount>0&&(e.page.SkipCount=0,e.GetIndependentDetectorList()),e.GetIndependentDetectorStatesNum()})},openDialog:function(){this.clearFlag&&this.$refs.SmokesenseFrom.resetFields(),this.$refs.trendDialog.dialogVisible=!0;var e=localStorage.getItem("contractPhone");this.$set(this.SmokesenseFrom,"smsPhones",e)},submit_update:function(){var e=this;console.log("submit_update",this.SmokesenseFrom),this.$refs.SmokesenseFrom.validate(function(t){t&&(e.SmokesenseFrom.detectorId?e.$axios.put(e.$api.UpdateIndependentDetector,e.SmokesenseFrom):e.$axios.post(e.$api.AddIndependentDetector,e.SmokesenseFrom)).then(function(t){console.log("更新或者修改",t),e.$message.success((e.SmokesenseFrom.detectorId?"修改":"新增")+"设备成功"),e.$refs.trendDialog.dialogVisible=!1,e.GetIndependentDetectorList()}).catch(function(e){console.log("失败",e)})})},cancel:function(e){this.$refs[e].resetFields(),this.$refs.trendDialog.dialogVisible=!1},showdetails:function(e){this.clearFlag&&this.$refs.SmokesenseFrom.resetFields(),this.clearFlag=!0,this.$refs.trendDialog.dialogVisible=!0,this.GetIndependentDetector(e.detectorId)},GetIndependentDetector:function(e){var t=this;this.$axios.get(this.$api.GetIndependentDetector,{params:{detectorId:e}}).then(function(e){console.log("详情",e);var n=o()(e.data.result);t.SmokesenseFrom=JSON.parse(n)})},DeleteIndependentDetector:function(e){var t=this;console.log("删除",e),this.$axios.delete(this.$api.DeleteIndependentDetector,{params:{detectorId:e.detectorId}}).then(function(e){console.log("删除数据成功"),t.$message.success("删除数据成功"),t.GetIndependentDetectorList()})},prev_next:function(e){this.page.SkipCount=(e-1)*this.page.MaxResultCount,this.GetIndependentDetectorList()}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"IndependentSmokesenseBox"},[n("el-row",{staticClass:"allStatus"},[n("el-col",{staticClass:"allStatus_left",attrs:{span:21}},e._l(e.buttonarr,function(t){return n("el-button",{key:t.text,attrs:{round:"",plain:"",type:t.type},on:{click:function(n){return e.screen(t.text)}}},[e.screensign==t.text?n("i",{staticClass:"el-icon-check  el-icon--right"}):e._e(),e._v("\n                "+e._s(t.text)+e._s(t.num)+"\n            ")])}),1),e._v(" "),n("el-col",{staticClass:"allStatus_right",attrs:{span:3}},[n("el-button",{attrs:{type:"primary",plain:""},on:{click:e.openDialog}},[e._v("新增")])],1)],1),e._v(" "),n("base-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",tableThead:e.tabelThead,tableData:e.tableData,totalCount:e.TotalCount,pageSize:10},on:{showdetails:e.showdetails,deleteInfo:e.DeleteIndependentDetector,pageChange:e.prev_next}}),e._v(" "),n("base-dialog",{ref:"trendDialog",attrs:{title:" 设备信息"}},[n("el-form",{ref:"SmokesenseFrom",staticClass:"formBox",attrs:{rules:e.rules,model:e.SmokesenseFrom,"label-width":"120px"}},[n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"设备编号",prop:"detectorSn"}},[n("el-input",{attrs:{placeholder:"请输入设备编号"},model:{value:e.SmokesenseFrom.detectorSn,callback:function(t){e.$set(e.SmokesenseFrom,"detectorSn",t)},expression:"SmokesenseFrom.detectorSn"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"设备品牌",prop:"brand"}},[n("el-input",{attrs:{placeholder:"请输入设备品牌"},model:{value:e.SmokesenseFrom.brand,callback:function(t){e.$set(e.SmokesenseFrom,"brand",t)},expression:"SmokesenseFrom.brand"}})],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:"安装位置",prop:"location"}},[n("el-input",{attrs:{placeholder:"请输入安装位置"},model:{value:e.SmokesenseFrom.location,callback:function(t){e.$set(e.SmokesenseFrom,"location",t)},expression:"SmokesenseFrom.location"}})],1)],1)],1),e._v(" "),n("el-row",[n("el-form-item",{attrs:{label:"设备故障时"}},[n("el-checkbox",{attrs:{label:"推送短信通知",name:"type"},model:{value:e.SmokesenseFrom.enableFaultSMS,callback:function(t){e.$set(e.SmokesenseFrom,"enableFaultSMS",t)},expression:"SmokesenseFrom.enableFaultSMS"}})],1)],1),e._v(" "),n("el-row",[n("el-form-item",{attrs:{label:"设备火警时"}},[n("el-checkbox",{attrs:{label:"推送短信通知",name:"type"},model:{value:e.SmokesenseFrom.enableAlarmSMS,callback:function(t){e.$set(e.SmokesenseFrom,"enableAlarmSMS",t)},expression:"SmokesenseFrom.enableAlarmSMS"}}),e._v(" "),e.SmokesenseFrom.enableAlarmSMS?n("el-row",[n("p",{staticClass:"tips"},[e._v("短信通知手机号码（多个手机号以英文逗号分隔）")]),e._v(" "),n("el-input",{attrs:{placeholder:"请输入接收手机"},model:{value:e.SmokesenseFrom.smsPhones,callback:function(t){e.$set(e.SmokesenseFrom,"smsPhones",t)},expression:"SmokesenseFrom.smsPhones"}})],1):e._e()],1)],1),e._v(" "),n("el-row",{staticClass:"btn_row"},[n("el-button",{on:{click:e.submit_update}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:function(t){return e.cancel("SmokesenseFrom")}}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]};var d=n("VU/8")(c,m,!1,function(e){n("c0Fe")},null,null);t.default=d.exports},c0Fe:function(e,t){}});
//# sourceMappingURL=25.8553e1f56a9ae37f15c4.js.map